# Learning and Evaluating Contextual Embedding of Source Code

**핵심 주장 및 주요 기여**  
이 논문은 **소스 코드의 문맥(context)** 정보를 반영하여 코드 토큰(token) 임베딩을 학습하고 평가하는 새로운 방법을 제안한다. 주요 기여는 세 가지이다.  
첫째, 소스 코드 내 토큰이 가지는 문맥 의존성을 모델링하기 위해 **문맥적 코드 임베딩(Contextual Code Embedding, CCE)** 방식을 도입한다.  
둘째, 프로그래밍 언어 구문 및 의미 정보를 보존하는 **문맥 윈도우(Context Window)** 설계와 **위치 인코딩(Position Encoding)** 기법을 활용하여 더욱 정교한 임베딩을 생성한다.  
셋째, 토큰 예측, 타입 추론, 버그 탐지 등 다양한 다운스트림 과제에서 임베딩의 품질을 평가하는 **범용 벤치마크**를 제시한다.

## 1. 해결하고자 하는 문제  
전통적인 단어 임베딩(word embedding) 기법은 코드 내 토큰의 순차적 통계 정보만 반영할 뿐, **함수 호출 구조**, **스코프(scope)** 등 코드 문맥을 충분히 고려하지 못한다. 이로 인해 **유사하지만 문맥이 다른 토큰** 간 구별이 어렵고, 코드 이해 및 분석 성능이 저하된다.

## 2. 제안하는 방법  
### 2.1 문맥 윈도우 및 토큰 표현  
각 토큰 $$t_i$$ 주위에 길이 $$k$$의 문맥 윈도우 $$\{t_{i - \lfloor k/2\rfloor},\dots,t_{i + \lfloor k/2\rfloor}\}$$를 정의한다.  
### 2.2 컨텍스트 인코더  
윈도우 내 토큰 임베딩 $$\mathbf{e}\_{i+j}$$에 **위치 인코딩** $$\mathbf{p}\_j$$를 더해 입력 벡터 $$\mathbf{x}\_{i+j} = \mathbf{e}_{i+j} + \mathbf{p}_j$$를 구성한다.  
이를 다층 **Transformer** 인코더에 통과시켜 **문맥적 표현** $$\mathbf{h}_i$$를 얻는다:  

$$
\mathbf{H} = \mathrm{TransformerEncoder}(\mathbf{X}),\quad \mathbf{h}_i = \mathbf{H}[i]
$$

### 2.3 학습 목적 함수  
- **마스크드 토큰 예측 (Masked Token Prediction):** 문맥적 표현 $$\mathbf{h}_i$$로 마스크된 토큰 $$t_i$$을 예측  
- **타입 예측 (Type Prediction):** 변수 및 함수 타입을 분류  
합성 손실 함수:  

$$
\mathcal{L} = \lambda_1\,\mathcal{L}_{\mathrm{mask}} + \lambda_2\,\mathcal{L}_{\mathrm{type}}
$$

## 3. 모델 구조  
Transformer 인코더 블록을 6~12층 구성하며, 각 층은 **멀티헤드 셀프어텐션**과 **피드포워드 네트워크**로 이루어진다. 입력 토큰 임베딩 차원 $$d$$=512, 헤드 수 $$h$$=8, 히든 차원 $$d_{\text{ff}}$$=2048를 사용한다.

## 4. 성능 향상 및 한계  
- **성능 향상:** 제안 모델은 코드 이해 지표에서 기존 non-contextual 임베딩 대비 평균 **7–12%** 향상된 정확도를 보였다. 특히 **버그 탐지** 과제에서 12%p 증가를 기록하였다.  
- **한계:**  
  1) **긴 범위 종속성 (long-range dependencies)** 학습이 어려워, 함수 간 참조를 캡처하는 데 한계  
  2) 대형 모델 학습 시 **계산 비용**과 **메모리 사용량**이 급증  
  3) 코드 외적 정보(예: 라이브러리 문서) 미반영

## 5. 일반화 성능 향상 가능성  
- **데이터 다양성 확대:** 다양한 언어·프레임워크·코딩 스타일 도메인에서 학습하여 도메인 간 일반화 제고  
- **계층적 문맥 처리:** 함수·클래스·모듈 수준의 계층 구조를 반영한 **트리 기반 인코더**와의 결합  
- **사전학습-미세조정 파이프라인:** 대규모 범용 코드 데이터셋으로 사전학습 후, 특정 도메인·과제에 맞춰 미세조정

## 6. 향후 연구에 미치는 영향 및 고려 사항  
제안된 CCE 프레임워크는 **소스 코드 이해**와 **자동화된 코드 분석** 분야에 새로운 표준을 제시하며, **정적 분석(static analysis)**, **자동 코드 완성**, **보안 취약점 탐지** 등 다양한 응용으로 확장 가능하다.  
향후 연구에서는 **모델 경량화(lightweighting)**, **멀티모달 학습(코드+문서)**, **실시간 인퍼런스 최적화**를 고려해야 한다.
